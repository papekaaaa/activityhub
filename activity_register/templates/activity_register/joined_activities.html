{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4 mb-5">
  <a href="{% url 'profile' %}" class="text-decoration-none text-dark d-inline-flex align-items-center mb-3">
    <i class="fa-solid fa-arrow-left me-2"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
  </a>

  <h4 class="fw-semibold mb-3">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h4>

  {% if joined_posts or registered_posts %}
    <div class="list-group">
      {% for post in joined_posts %}
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <div class="me-3">
            {% if post.is_deleted or post.is_hidden %}
              <span class="fw-bold text-danger">{{ post.title }} (‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)</span>
            {% else %}
              <a href="{% url 'post:post_detail' post.id %}" class="fw-semibold text-decoration-none text-dark">
                {{ post.title }}
              </a>
            {% endif %}
            <div class="text-muted small">
              üìÖ {{ post.event_date|date:"j M Y" }} ¬∑ üìç {{ post.location }}
            </div>
          </div>

          {% if post.id in reviewed_post_ids %}
            {% if post.is_deleted or post.is_hidden %}
              <button class="btn btn-secondary btn-sm rounded-pill" disabled>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
            {% else %}
              <a href="{% url 'activity_register:review_activity' post.id %}"
                 class="btn btn-success btn-sm rounded-pill">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß</a>
            {% endif %}
          {% else %}
            {% if post.is_deleted or post.is_hidden %}
              <button class="btn btn-secondary btn-sm rounded-pill" disabled>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
            {% else %}
              <a href="{% url 'activity_register:review_activity' post.id %}"
                 class="btn btn-warning btn-sm rounded-pill">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
            {% endif %}
          {% endif %}
        </div>
      {% endfor %}

      {% for post in registered_posts %}
        {% if post not in joined_posts %}
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <div class="me-3">
            {% if post.is_deleted %}
              <span class="fw-bold text-danger">{{ post.title }} (‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)</span>
            {% else %}
              <a href="{% url 'post:post_detail' post.id %}" class="fw-semibold text-decoration-none text-dark">
                {{ post.title }}
              </a>
            {% endif %}
            <div class="text-muted small">
              üìÖ {{ post.event_date|date:"j M Y" }} ¬∑ üìç {{ post.location }}
            </div>
          </div>
          {% comment %} show registration status badge by matching reg_map items {% endcomment %}
          {% if post.id in reg_map_keys %}
            {% for key, reg in reg_map.items %}
              {% if key == post.id %}
                {% if reg.status == 'ACTIVE' %}
                  <span class="badge bg-success rounded-pill align-self-start">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß</span>
                {% elif reg.status == 'CANCEL_PENDING' %}
                  <span class="badge bg-warning text-dark rounded-pill align-self-start">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                {% elif reg.status == 'CANCELED' %}
                  <span class="badge bg-secondary rounded-pill align-self-start">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span>
                {% else %}
                  <span class="badge bg-light rounded-pill align-self-start">{{ reg.get_status_display }}</span>
                {% endif %}
              {% endif %}
            {% endfor %}
          {% else %}
            <span class="badge bg-light rounded-pill align-self-start">-</span>
          {% endif %}
        </div>
        {% endif %}
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>
  {% endif %}
</div>
{% endblock %}
