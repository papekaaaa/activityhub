{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  body {
    background-color: #f5f6f7 !important;
  }

  /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å */
  .profile-header-box {
    background-color: #fff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    margin-bottom: 2rem;
  }

  /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (cover) */
  .cover-area {
    position: relative;
    width: 100%;
    height: 230px;
    background-color: #d9d9d9; /* ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ cover ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ */
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    overflow: hidden;
  }

  .cover-area img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏≠‡∏¢‡∏ó‡∏±‡∏ö */
  .profile-picture-wrapper {
    position: relative;
    height: 0;
  }

  .profile-picture-main {
    width: 140px;
    height: 140px;
    object-fit: cover;
    border-radius: 50%;
    border: 6px solid #fff;
    position: absolute;
    top: -70px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }

  /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå */
  .profile-info-main {
    text-align: center;
    padding-top: 88px;
    padding-bottom: 1.25rem;
  }

  .profile-info-main h3 {
    font-size: 1.6rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  /* ‡πÅ‡∏ñ‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ + ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ */
  .profile-bottom-row {
    border-top: 1px solid #eee;
    padding: 0.9rem 1.5rem 1.1rem;
  }

  .profile-actions .btn {
    border-radius: 999px;
    font-size: 0.9rem;
  }

  /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô */
  .my-activity-card {
    border-radius: 16px;
    overflow: hidden;
  }

  .my-activity-card img {
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
  }

  /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô */
  .registered-box {
    border-radius: 16px;
  }
</style>

<div class="container mt-4 mb-5">

  <!-- HEADER ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ö‡∏ö‡∏°‡∏µ cover -->
  <div class="profile-header-box">
    <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á -->
    <div class="cover-area">
      {% if profile.cover_picture %}
        <img src="{{ profile.cover_picture.url }}" alt="Cover">
      {% endif %}
    </div>

    <!-- ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏≠‡∏¢ -->
    <div class="profile-picture-wrapper">
      {% if profile.profile_picture %}
        <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" class="profile-picture-main">
      {% else %}
        <img src="{% static 'images/default_profile.png' %}" alt="Profile Picture" class="profile-picture-main">
      {% endif %}
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á -->
    <div class="profile-info-main">
      <h3>{{ user.first_name }} {{ user.last_name }}</h3>
      <p class="text-muted mb-1">{{ user.email }}</p>
      <div class="d-flex justify-content-center gap-4 text-muted small">
        <span><strong>{{ followers_count }}</strong> ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</span>
        <span><strong>{{ following_count }}</strong> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</span>
      </div>
    </div>

    <!-- ‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏á: ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ + ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center profile-bottom-row">
      <div class="text-muted small mb-2 mb-md-0">
        <!-- future info -->
      </div>
      <div class="profile-actions d-flex flex-wrap gap-2">
        <a href="{% url 'profile_edit' %}" class="btn btn-outline-primary btn-sm">
          <i class="fa-solid fa-pen me-1"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        </a>
        <a href="{% url 'activity_register:edit_register_profile' %}" class="btn btn-outline-secondary btn-sm">
          <i class="fa-solid fa-id-card-clip me-1"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
        </a>
        <a href="{% url 'post:create_post' %}" class="btn btn-primary btn-sm">
          <i class="fa-solid fa-plus me-1"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
        </a>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT: ‡∏ã‡πâ‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô / ‡∏Ç‡∏ß‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
  <div class="row g-4">
    <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô -->
    <div class="col-lg-8">
      <h5 class="mb-3 fw-semibold">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h5>
      <div class="row row-cols-1 row-cols-md-2 g-4">
        {% for post in user_posts %}
          <div class="col">
            <div class="card h-100 shadow-sm my-activity-card">
              {% if post.image %}
                <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}" style="height: 200px; object-fit: cover;">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title mb-1 text-truncate">{{ post.title }}</h5>
                <p class="card-text mb-1">
                  <span class="badge
                    {% if post.status == 'APPROVED' %} bg-success
                    {% elif post.status == 'PENDING' %} bg-warning text-dark
                    {% else %} bg-danger {% endif %}">
                    {{ post.get_status_display }}
                  </span>
                </p>
                <p class="text-muted small mb-0">
                  üìÖ {{ post.event_date|date:"j M Y" }} ¬∑ üìç {{ post.location }}
                </p>
              </div>
              <div class="card-footer bg-transparent border-0 d-flex justify-content-end gap-2 p-3">
                <a href="{% url 'post:post_detail' post.id %}" class="btn btn-outline-primary btn-sm">
                  ‡∏î‡∏π
                </a>
                <a href="{% url 'post:post_edit' post.id %}" class="btn btn-outline-secondary btn-sm">
                  ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </a>
                <button type="button"
                        class="btn btn-outline-danger btn-sm"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteModal"
                        data-post-id="{{ post.id }}"
                        data-post-title="{{ post.title }}">
                  ‡∏•‡∏ö
                </button>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="col-12">
            <div class="text-center p-5 bg-light rounded-3">
              <h4>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏î‡πÜ</h4>
              <p class="text-muted">‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
              <a href="{% url 'post:create_post' %}" class="btn btn-primary mt-2">
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
              </a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô + ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° -->
    <div class="col-lg-4">
      <div class="card shadow-sm border-0 registered-box">
        <div class="card-body">
          <h5 class="fw-semibold mb-3 d-flex justify-content-between align-items-center">
            <span>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</span>
            <a href="{% url 'activity_register:joined_activities' %}"
               class="btn btn-outline-secondary btn-sm">
              ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
            </a>
          </h5>

          {% if registrations %}
            <div class="list-group list-group-flush">
              {% for reg in registrations %}
                <a href="{% url 'post:post_detail' reg.post.id %}"
                   class="list-group-item list-group-item-action border-0 px-0 mb-2">
                  <div class="d-flex justify-content-between">
                    <div class="me-2">
                      <div class="small fw-semibold text-truncate">
                        {{ reg.post.title }}
                      </div>
                      <div class="text-muted small">
                        üìÖ {{ reg.post.event_date|date:"j M Y" }} ¬∑ üìç {{ reg.post.location }}
                      </div>
                    </div>
                    <span class="badge bg-success rounded-pill align-self-start">
                      ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß
                    </span>
                  </div>
                </a>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-muted small mb-0">
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
            </p>
          {% endif %}

          <p class="text-muted small mt-3 mb-0">
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
          </p>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "<strong id="postTitle"></strong>"?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <form id="deleteForm" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  var deleteModal = document.getElementById('deleteModal');
  if (deleteModal) {
    deleteModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var postId = button.getAttribute('data-post-id');
      var postTitle = button.getAttribute('data-post-title');
      var deleteUrl = `/post/${postId}/delete/`;
      deleteModal.querySelector('#postTitle').textContent = postTitle;
      deleteModal.querySelector('#deleteForm').setAttribute('action', deleteUrl);
    });
  }
});
</script>
{% endblock %}
