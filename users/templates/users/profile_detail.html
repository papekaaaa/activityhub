{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  body {
    background-color: #f5f6f7 !important;
  }

  .profile-header {
    background-color: #fff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    margin-bottom: 2rem;
  }

  .cover-area {
    position: relative;
    width: 100%;
    height: 230px;
    background-color: #d9d9d9;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    overflow: hidden;
  }
  .cover-area img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .profile-picture-wrapper {
    position: relative;
    height: 0;
  }

  /* ‚úÖ ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° */
  .profile-picture {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 50%;
    border: 6px solid #fff;
    position: absolute;
    top: -75px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }

  .profile-info {
    text-align: center;
    padding-top: 90px;
    padding-bottom: 1rem;
  }

  .username {
    font-size: 1.6rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .follow-btn {
    background-color: #e8eeff;
    color: #2c2c2c;
    border: none;
    border-radius: 999px;
    font-weight: 600;
    transition: background-color 0.2s ease;
  }
  .follow-btn:hover {
    background-color: #d0dcff;
  }

  .post-card {
    border-radius: 16px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  }

  .activity-sidebar {
    background-color: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 1.2rem;
  }

  .activity-item-title {
    font-size: 0.95rem;
    font-weight: 600;
  }

  .activity-item-meta {
    font-size: 0.8rem;
  }

  /* ‚úÖ avatar ‡∏Å‡∏•‡∏°‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ */
  .avatar-circle {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    object-fit: cover;
    display: block;
    flex-shrink: 0;
  }
</style>

<div class="container mt-4 mb-5">
  <div class="profile-header">
    <div class="cover-area">
      {% if profile.cover_picture %}
        <img src="{{ profile.cover_picture.url }}" alt="cover">
      {% endif %}
    </div>

    <div class="profile-picture-wrapper">
      {% if profile.profile_picture %}
        <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" class="profile-picture">
      {% else %}
        <img src="{% static 'images/default_profile.png' %}" alt="Profile Picture" class="profile-picture">
      {% endif %}
    </div>

    <div class="profile-info">
      <h3 class="username">
        {{ target_user.first_name }} {{ target_user.last_name }}
      </h3>
      <p class="text-muted mb-1">{{ target_user.email }}</p>
      <div class="d-flex justify-content-center gap-4 mb-3 text-muted small">
        <span><strong>{{ followers_count }}</strong> ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</span>
        <span><strong>{{ following_count }}</strong> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</span>
      </div>

      {% if request.user.id != target_user.id %}
      <div class="d-flex justify-content-center gap-2 mb-3">
        <form method="post" action="{% url 'follow_toggle' target_user.id %}">
          {% csrf_token %}
          {% if is_following %}
            <button class="btn follow-btn px-4">
              <i class="fa-solid fa-user-minus me-1"></i> ‡πÄ‡∏•‡∏¥‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
            </button>
          {% else %}
            <button class="btn follow-btn px-4">
              <i class="fa-solid fa-user-plus me-1"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
            </button>
          {% endif %}
        </form>

        <a href="{% url 'chat:dm_chat' target_user.id %}"
           class="btn btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center"
           style="width:44px;height:44px;">
          <i class="fa-regular fa-comment"></i>
        </a>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8 mb-4">
      <h5 class="fw-semibold mb-3">‡πÇ‡∏û‡∏™‡∏ï‡πå</h5>
      {% if posts %}
        {% for post in posts %}
        <div class="post-card mb-4 p-3">
          <div class="d-flex align-items-center mb-3">
            {% if profile.profile_picture %}
              <img src="{{ profile.profile_picture.url }}"
                   class="avatar-circle me-2"
                   alt="{{ target_user.first_name }} {{ target_user.last_name }}">
            {% else %}
              <img src="{% static 'images/default_profile.png' %}"
                   class="avatar-circle me-2"
                   alt="Profile Picture">
            {% endif %}
            <div>
              <p class="mb-0 fw-semibold">
                {{ target_user.first_name }} {{ target_user.last_name }}
              </p>
              <small class="text-muted">
                {{ post.created_at|date:"d M Y" }}
              </small>
            </div>
          </div>

          {% if post.image %}
            <img src="{{ post.image.url }}"
                 class="img-fluid rounded-3 mb-3"
                 alt="{{ post.title }}">
          {% endif %}

          <p class="fw-semibold mb-1">{{ post.title }}</p>
          <p class="text-muted mb-2">{{ post.description|truncatechars:150 }}</p>
          <a href="{% url 'post:post_detail' post.id %}"
             class="text-decoration-none text-primary fw-semibold">
            ‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
          </a>
        </div>
        {% endfor %}
      {% else %}
        <div class="text-center text-muted mt-5">
          ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
        </div>
      {% endif %}
    </div>

    <div class="col-lg-4">
      <div class="activity-sidebar">
        <h6 class="fw-semibold mb-3">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h6>

        {% if registrations %}
          <div class="list-group list-group-flush">
            {% for reg in registrations|slice:":5" %}
              <a href="{% url 'post:post_detail' reg.post.id %}"
                 class="list-group-item list-group-item-action border-0 px-0 mb-2">
                <div class="activity-item-title text-truncate">
                  {{ reg.post.title }}
                </div>
                <div class="text-muted activity-item-meta">
                  {% if reg.post.event_date %}
                    üìÖ {{ reg.post.event_date|date:"j M Y" }}
                  {% endif %}
                  {% if reg.post.location %}
                    ¬∑ üìç {{ reg.post.location }}
                  {% endif %}
                </div>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted small mb-0">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
