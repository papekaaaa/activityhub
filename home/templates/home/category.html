{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <h2 class="fw-semibold text-center mb-4">
    {% if selected_category %}
      หมวดหมู่: {{ selected_category }}
    {% else %}
      ทุกกิจกรรม
    {% endif %}
  </h2>

  {% if posts %}
  <div class="row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts %}
    <div class="col">
      <div class="card shadow-sm border-0 h-100">
        {% if post.image %}
        <div class="activity-img-wrap">
          <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}">
        </div>
        {% endif %}

        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <p class="card-text text-muted">{{ post.description|truncatechars:100 }}</p>
        </div>
        <div class="card-footer bg-white border-0 d-flex align-items-center">
          <a href="{% url 'profile_detail' post.organizer.id %}">
            {% if post.organizer.profile.profile_picture %}
              <img src="{{ post.organizer.profile.profile_picture.url }}" class="rounded-circle me-2" width="36" height="36" style="object-fit: cover;">
            {% else %}
              <img src="{% static 'images/default_profile.png' %}" class="rounded-circle me-2" width="36" height="36" style="object-fit: cover;">
            {% endif %}
          </a>
          <div>
            <a href="{% url 'profile_detail' post.organizer.id %}" class="text-dark text-decoration-none fw-semibold hover-link">
              {{ post.organizer.first_name|default:post.organizer.email }}
            </a><br>
            <small class="text-muted">{{ post.created_at|date:"d M Y" }}</small>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-center text-muted">ยังไม่มีกิจกรรมในหมวดนี้</p>
  {% endif %}
</div>

<style>
.hover-link:hover { color: #0d6efd; }

/* ทำให้รูปทุกการ์ด "สมส่วน" และสูงเท่ากัน */
.activity-img-wrap{
  width: 100%;
  aspect-ratio: 4 / 3;      /* เปลี่ยนเป็น 16/9 ได้ถ้าอยากกว้างขึ้น */
  overflow: hidden;
  background: #f2f2f2;
}
.activity-img-wrap .card-img-top{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
</style>
{% endblock %}
