{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid p-0" style="font-family: 'Kanit', sans-serif;">
  <div class="map-header text-center py-4 bg-light shadow-sm">
    <h3 class="fw-bold mb-1">üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <p class="text-muted mb-3">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
    <a href="{% url 'home' %}" class="btn btn-outline-secondary btn-sm">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  </div>

  <div id="map" style="height: 80vh; width: 100%;"></div>
</div>

<!-- ‚úÖ Leaflet CDN -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid p-0" style="font-family: 'Kanit', sans-serif;">
  <div class="map-header text-center py-4 bg-light shadow-sm">
    <h3 class="fw-bold mb-1">üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <p class="text-muted mb-3">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
    <a href="{% url 'home' %}" class="btn btn-outline-secondary btn-sm">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  </div>

  <div id="map" style="height: 80vh; width: 100%;"></div>
</div>

<!-- ‚úÖ Leaflet CDN -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏π‡∏õ JSON -->
{{ posts|json_script:"posts-data" }}

<script>
document.addEventListener('DOMContentLoaded', function() {
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  const map = L.map('map').setView([15.2294, 104.8560], 8); // ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);

  // ‚úÖ ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å JSON ‡∏ó‡∏µ‡πà Django ‡∏™‡πà‡∏á‡∏°‡∏≤
  const postsData = JSON.parse(document.getElementById("posts-data").textContent);

  postsData.forEach(post => {
    if (post.map_lat && post.map_lng) {
      const marker = L.marker([post.map_lat, post.map_lng]).addTo(map);
      const popup = `
        <div style="min-width:180px">
          <h6 class="fw-bold mb-1">${post.title}</h6>
          <p class="text-muted small mb-1">${post.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'}</p>
          <a href="/post/${post.id}/" class="btn btn-sm btn-primary mt-2">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
        </div>`;
      marker.bindPopup(popup);
    }
  });
});
</script>

<style>
  body {
    background-color: #f8f9fa !important;
  }
  .map-header {
    border-bottom: 1px solid #e5e5e5;
  }
  #map .leaflet-popup-content-wrapper {
    border-radius: 12px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }
</style>
{% endblock %}


<!-- ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏à‡∏≤‡∏Å Django -->
<script id="posts-data" type="application/json">
  {{ posts|json_script:"posts" }}
</script>

<script>
  const postsData = JSON.parse(document.getElementById("posts-data").textContent);

  postsData.forEach(post => {
    if (post.map_lat && post.map_lng) {
      const marker = L.marker([post.map_lat, post.map_lng]).addTo(map);
      const popupContent = `
        <div style="min-width:180px">
          <h6 class="fw-bold mb-1">${post.title}</h6>
          <p class="text-muted small mb-1">${post.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'}</p>
          <a href="/post/${post.id}/" class="btn btn-sm btn-primary mt-2">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
        </div>`;
      marker.bindPopup(popupContent);
    }
  });
</script>

<style>
  body {
    background-color: #f8f9fa !important;
  }
  .map-header {
    border-bottom: 1px solid #e5e5e5;
  }
  #map .leaflet-popup-content-wrapper {
    border-radius: 12px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }
</style>
{% endblock %}
